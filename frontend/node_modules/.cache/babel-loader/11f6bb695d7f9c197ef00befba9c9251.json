{"ast":null,"code":"var _jsxFileName = \"/Users/IuliiaSaprykina/Development/code/Mod4/Projects/meal_app/frontend/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport PrivateRoute from './components/PrivateRoute';\nimport Login from './components/Login';\nimport { Route, Switch, Redirect, withRouter } from \"react-router-dom\";\nimport Signup from './components/Signup';\nimport Favorites from \"./components/Favorites\";\n\n((nm, tm) => {\n  const lStorage = localStorage;\n  const sStorage = sessionStorage;\n\n  const tabId = sStorage.getItem(tm) || (newId => {\n    sStorage.setItem(tm, newId);\n    return newId;\n  })((Math.random() * 1e8).toFixed());\n\n  const update = setTabValue => {\n    let currentValue = JSON.parse(lStorage.getItem(nm) || '{}');\n    const arrValue = Object.values(currentValue);\n\n    if (setTabValue && typeof currentValue[tabId] === 'undefined' && !arrValue.reduce((sum, current) => {\n      return sum + current;\n    }, 0)) {\n      lStorage.clear();\n      currentValue = {};\n    }\n\n    currentValue[tabId] = setTabValue;\n    lStorage.setItem(nm, JSON.stringify(currentValue));\n  };\n\n  update(1);\n\n  window.onbeforeunload = () => {\n    update(0);\n  };\n})('tabs', 'tabid');\n\nconst recipesUrl = \"http://localhost:3000/recipes/\";\nconst favoritesUrl = \"http://localhost:3000/user_recipes/\";\nconst profileUrl = \"http://localhost:3000/profile\";\nconst loginUrl = \"http://localhost:3000/login/\";\nconst usersUrl = \"http://localhost:3000/users/\";\n\nclass App extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      favorites: [],\n      recipes: [],\n      user: {},\n      alert: \"\"\n    };\n\n    this.validateUser = () => {\n      const token = localStorage.token;\n\n      if (token) {\n        fetch(profileUrl, {\n          method: \"GET\",\n          headers: {\n            \"Content-type\": \"application/json\",\n            'Authorization': `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        }).then(response => response.json()).then(response => {\n          this.setState({\n            user: response.user,\n            recipes: response.user.user.recipes\n          });\n        }); // .then(response => console.log(response.user.user.recipes))\n      }\n    };\n\n    this.getFavorites = () => {\n      fetch(favoritesUrl, {\n        method: 'GET',\n        headers: {\n          'Content-type': 'application/json',\n          // 'Accept': 'application/json',\n          'Authorization': `Bearer ${localStorage.getItem(\"token\")}`\n        }\n      }).then(response => response.json()).then(favorites => this.setState({\n        favorites\n      }));\n    };\n\n    this.login = user => {\n      fetch(loginUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          user: user\n        })\n      }).then(response => response.json()).then(response => {\n        if (response.message) {\n          this.setState({\n            alert: response.message\n          });\n        } else {\n          localStorage.setItem(\"token\", response.jwt);\n          localStorage.setItem(\"user_id\", response.user.user.id);\n          this.setState({\n            user: response.user,\n            recipes: response.user.recipes,\n            alert: \"\"\n          });\n        }\n      }).then(() => this.props.history.push('/')); // .then(response => console.log(response.user.user.id))\n    };\n\n    this.signup = user => {\n      fetch(usersUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          user: user\n        })\n      }).then(response => response.json()).then(response => {\n        if (response.message) {\n          this.setState({\n            alert: response.message\n          });\n        }\n      });\n    };\n\n    this.addToFavorite = (recipeId, userId) => {\n      const newFavorite = {\n        userRecipe: {\n          recipe_id: recipeId,\n          user_id: +userId\n        }\n      }; // this.setState({favorites: [...this.state.favorites, newFavorite]})\n\n      fetch(favoritesUrl, {\n        method: 'POST',\n        headers: {\n          'Content-type': 'application/json',\n          'Authorization': `Bearer ${localStorage.getItem(\"token\")}`\n        },\n        body: JSON.stringify(newFavorite)\n      }).then(response => response.json()).then(recipe => this.setState({\n        favorites: [...this.state.favorites, recipe.user_recipe]\n      }));\n    };\n\n    this.addRecipe = recipe => {\n      this.setState({\n        recipes: [...this.state.recipes, recipe]\n      });\n      let newRecipe = { ...recipe\n      };\n      fetch(recipesUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          'Authorization': `Bearer ${localStorage.getItem(\"token\")}`\n        },\n        body: JSON.stringify(newRecipe)\n      }).then(response => response.json()).then(recipe => {\n        this.addToFavorite(recipe.id, localStorage.getItem(\"user_id\"));\n      });\n    };\n\n    this.deleteFavorite = id => {\n      let favorites = this.state.favorites.filter(fav => fav.id !== id);\n      this.setState({\n        favorites\n      });\n      fetch(favoritesUrl + id, {\n        method: \"DELETE\"\n      });\n    };\n  }\n\n  componentDidMount() {\n    // this.getRecipes();\n    this.getFavorites();\n    this.validateUser(); // this.getUser();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(PrivateRoute, {\n      exact: true,\n      path: \"/\",\n      addRecipe: this.addRecipe,\n      addToFavorite: this.addToFavorite,\n      favorites: this.state.favorites,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/login\",\n      render: props => /*#__PURE__*/React.createElement(Login, Object.assign({}, props, {\n        login: this.login,\n        alert: this.state.alert,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 13\n        }\n      })),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/signup\",\n      render: props => /*#__PURE__*/React.createElement(Signup, Object.assign({}, props, {\n        signup: this.signup,\n        alert: this.state.alert,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 13\n        }\n      })),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/favorites\",\n      render: () => /*#__PURE__*/React.createElement(Favorites, {\n        validateUser: this.validateUser,\n        user: this.state.user,\n        favorites: this.state.favorites,\n        recipes: this.state.recipes,\n        deleteFavorite: this.deleteFavorite,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 27\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      render: () => /*#__PURE__*/React.createElement(Redirect, {\n        to: \"/\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 32\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}\n\nexport default withRouter(App);","map":{"version":3,"sources":["/Users/IuliiaSaprykina/Development/code/Mod4/Projects/meal_app/frontend/src/App.js"],"names":["React","Component","PrivateRoute","Login","Route","Switch","Redirect","withRouter","Signup","Favorites","nm","tm","lStorage","localStorage","sStorage","sessionStorage","tabId","getItem","newId","setItem","Math","random","toFixed","update","setTabValue","currentValue","JSON","parse","arrValue","Object","values","reduce","sum","current","clear","stringify","window","onbeforeunload","recipesUrl","favoritesUrl","profileUrl","loginUrl","usersUrl","App","state","favorites","recipes","user","alert","validateUser","token","fetch","method","headers","then","response","json","setState","getFavorites","login","body","message","jwt","id","props","history","push","signup","addToFavorite","recipeId","userId","newFavorite","userRecipe","recipe_id","user_id","recipe","user_recipe","addRecipe","newRecipe","deleteFavorite","filter","fav","componentDidMount","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport PrivateRoute from './components/PrivateRoute';\nimport Login from './components/Login';\nimport { Route, Switch, Redirect, withRouter } from \"react-router-dom\"\nimport Signup from './components/Signup';\nimport Favorites from \"./components/Favorites\";\n\n\n((nm, tm) => {\n  const lStorage = localStorage;\n  const sStorage = sessionStorage;\n  const tabId = sStorage.getItem(tm)\n    || ((newId) => {\n      sStorage.setItem(tm, newId);\n      return newId;\n    })((Math.random() * 1e8).toFixed());\n  const update = (setTabValue) => {\n    let currentValue = JSON.parse(lStorage.getItem(nm) || '{}');\n    const arrValue: number[] = Object.values(currentValue);\n    if (setTabValue\n      && typeof currentValue[tabId] === 'undefined'\n      && !arrValue.reduce((sum, current) => { return sum + current; }, 0)) {\n      lStorage.clear();\n      currentValue = {};\n    }\n    currentValue[tabId] = setTabValue;\n    lStorage.setItem(nm, JSON.stringify(currentValue));\n  };\n  update(1);\n  window.onbeforeunload = () => { update(0); };\n})('tabs', 'tabid');\n\nconst recipesUrl = \"http://localhost:3000/recipes/\";\nconst favoritesUrl = \"http://localhost:3000/user_recipes/\";\nconst profileUrl = \"http://localhost:3000/profile\";\nconst loginUrl =\"http://localhost:3000/login/\";\nconst usersUrl = \"http://localhost:3000/users/\"\n\nclass App extends Component {\n\n  state = {\n    favorites: [],\n    recipes: [], \n    user: {},\n    alert: \"\"\n  }\n\n  componentDidMount(){\n    // this.getRecipes();\n    this.getFavorites();\n    this.validateUser();\n    // this.getUser();\n  }\n\n  validateUser = () => {\n    const token = localStorage.token\n    if(token){\n      fetch(profileUrl, {\n        method: \"GET\",\n        headers: {\n          \"Content-type\": \"application/json\",\n          'Authorization': `Bearer ${localStorage.getItem(\"token\")}`\n        }\n      })\n        .then(response => response.json())\n        .then(response => {\n          this.setState({\n            user: response.user,\n            recipes: response.user.user.recipes\n          })\n        })\n        // .then(response => console.log(response.user.user.recipes))\n    }\n  }\n\n  // getRecipes = () => {\n  //   fetch(recipesUrl)\n  //   .then(response => response.json())\n  //   .then(recipes => this.setState({recipes}))\n  // }\n\n  getFavorites = () => {\n    fetch(favoritesUrl, { \n      method: 'GET',\n      headers: {\n        'Content-type' : 'application/json',\n        // 'Accept': 'application/json',\n        'Authorization': `Bearer ${localStorage.getItem(\"token\")}`\n      }\n    })\n      .then(response => response.json())\n      .then(favorites => this.setState({favorites}))\n  }\n\n  login = (user) => {\n    fetch(loginUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-type\" : \"application/json\"\n      },\n      body: JSON.stringify({user: user})\n    })\n    .then(response => response.json())\n    .then(response => {\n      if(response.message) {\n        this.setState({ alert: response.message})\n      } else {\n        localStorage.setItem(\"token\", response.jwt);\n        localStorage.setItem(\"user_id\", response.user.user.id);\n        this.setState({\n          user: response.user,\n          recipes: response.user.recipes,\n          alert: \"\"\n        })\n      }\n    })\n    .then(() => this.props.history.push('/'))\n    // .then(response => console.log(response.user.user.id))\n  }\n\n  signup = (user) => {\n    fetch(usersUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-type\" : \"application/json\"\n      },\n      body: JSON.stringify({user: user})\n    })\n    .then(response => response.json())\n    .then(response => {\n      if(response.message) {\n        this.setState({ alert: response.message})\n      } \n    })\n  }\n  // getUser = () => {\n  //   fetch(usersUrl)\n  //     .then(response => response.json())\n  //     .then(users => this.setState({users}))\n  // }\n\n  addToFavorite = (recipeId, userId) => {\n    const newFavorite = {\n      userRecipe:{\n        recipe_id: recipeId,\n        user_id: +userId\n      }\n    }\n    \n    // this.setState({favorites: [...this.state.favorites, newFavorite]})\n\n    fetch(favoritesUrl, {\n      method: 'POST',\n      headers: {\n        'Content-type' : 'application/json',\n        'Authorization': `Bearer ${localStorage.getItem(\"token\")}`\n      },\n      body: JSON.stringify(newFavorite)\n    })\n      .then(response => response.json())\n      .then((recipe) => this.setState({favorites: [...this.state.favorites, recipe.user_recipe]}))\n  }\n\n  addRecipe = (recipe) => {\n    this.setState({\n      recipes: [...this.state.recipes, recipe]\n    })\n\n    let newRecipe = {\n      ...recipe\n    }\n\n    fetch(recipesUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        'Authorization': `Bearer ${localStorage.getItem(\"token\")}`\n      },\n      body: JSON.stringify(newRecipe)\n    })\n      .then(response => response.json())\n      .then(recipe => {\n        this.addToFavorite(recipe.id, localStorage.getItem(\"user_id\"))\n      })\n  }\n\n  deleteFavorite = (id) => {\n    let favorites = this.state.favorites.filter(fav => fav.id !== id)\n\n    this.setState({favorites})\n\n    fetch(favoritesUrl + id, {\n      method: \"DELETE\"\n    })\n  }\n\n  render(){\n    return ( \n      <div className=\"App\">\n        <Switch>\n          <PrivateRoute \n            exact path=\"/\" \n            addRecipe={this.addRecipe} \n            addToFavorite={this.addToFavorite} \n            favorites={this.state.favorites}\n          />\n          <Route \n            path=\"/login\" \n            render={(props) => \n            <Login {...props} \n            login={this.login}\n            alert={this.state.alert}\n            />} \n          />\n          <Route \n            path=\"/signup\" \n            render={(props) => \n            <Signup {...props} \n            signup={this.signup}\n            alert={this.state.alert}\n            />} \n          />\n          <Route \n            path=\"/favorites\" \n            render={() => <Favorites \n                validateUser={this.validateUser}\n                user={this.state.user} \n                favorites={this.state.favorites} \n                recipes={this.state.recipes}\n                deleteFavorite={this.deleteFavorite}\n            />} \n          />\n          <Route render={() => <Redirect to=\"/\" />} />\n        </Switch>\n      </div>\n    );\n  }\n}\n\nexport default  withRouter(App)\n\n"]},"metadata":{},"sourceType":"module"}